#!/bin/bash

#in minutes
work_per_day=192

#in hours
work_per_week=32

worked_today="$(watson report -d -c -j | grep \"time\" | tail -n1 | grep -oE '[0-9]+' | head -n 1 | tr -d '\n')"
left_today=$(( work_per_day * 60 - worked_today ))

if [[ $left_today -ge 0 ]]; then
  formatted_time=$(date -u -d @${left_today} +"%-H:%M")
  printf "<span fgcolor='#B85261'><span size='16pt'> 󰃖  </span>%s</span>" "$formatted_time"
else
  worked_week="$(watson report -w -c -j | grep \"time\" | tail -n1 | grep -oE '[0-9]+' | head -n 1 | tr -d '\n')"
  weekday="$(date +%u)"

  remaining_days=$(( 8-weekday ))
  morning=$(( worked_week - worked_today ))
  byday=$(( (work_per_week * 3600 - morning) / remaining_days ))
  todo_today=$(( byday - worked_today ))

  if [[ $todo_today -ge 0 ]]; then
      formatted_time=$(date -u -d @${todo_today} +"%-H:%M")
      printf "<span fgcolor='#B8A952'><span size='16pt'> 󰃖  </span>%s</span>" "$formatted_time"
  else
      formatted_time=$(date -u -d @${todo_today#-} +"%-H:%M")
      printf "<span fgcolor='#94B852'><span size='16pt'> 󰃗  </span>%s</span>" "$formatted_time"
  fi
fi